<!-- The third page -> Displays the final allocation result returned by the algorithm -->

{% extends "layout.html" %}
{% block content %}
<div class="top-actions">
  <div class="left">
    <button type="button" class="back-btn" onclick="history.back()">↩ Back</button>
  </div>

  <div></div>

 <div class="right">
    <a href="{{ url_for('setup') }}" class="back-btn">⟲ Start Over</a>
  </div>
</div>

<!-- Styled final allocation header matching valuations page -->
<div id="finalAllocationMessage" class="explanation-text text-center mb-4">
  Final Allocation
</div>

<!-- Centered grid: one column per player -->
<div class="final-grid" id="finalGrid">
  {% for player, gifts in allocation.items() %}
    <div class="final-col">
      <div class="player-card">
        <div class="player-name">{{ player|replace('_',' ') }}</div>
        <div class="allocation">→ {{ gifts|sort|join(', ') | replace('c', 'Gift ') }}</div>

        <div class="sum-row">
          <img class="money-img" src="{{ url_for('static', filename='images/money.png') }}" alt="money">
          <span class="sum-value">
            {% if sum_values[player] is defined %}
              {{ sum_values[player] }}
            {% else %}
              0
            {% endif %}
          </span>
        </div>
      </div>
    </div>
  {% endfor %}
</div>


<!-- Toggle button -->
<div class="w-100 d-flex justify-content-center mt-3">
  <button class="sum-toggle-btn" type="button" onclick="toggleSums()">
    Σ Show Sum of Values
  </button>
</div>


<div>
    <!-- Button to open the window "show logs" -->
  <div class="w-100 d-flex justify-content-center mt-4">
    <button type="button" class="gift-btn action-btn" data-bs-toggle="modal" data-bs-target="#logsModal">
      <span>Show Logs</span>
      <img src="{{ url_for('static', filename='images/santa-claus.png') }}" alt="logs">
    </button>
  </div>


  <!-- Logs Modal -->
  <div class="modal fade" id="logsModal"
     data-bs-scroll="true"
     data-bs-backdrop="false"
     tabindex="-1" aria-labelledby="logsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="logsModalLabel">Algorithm Logs</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" style="max-height:60vh; overflow-y:auto;">
          <pre style="white-space: pre-wrap;">{{ logs|join('\n') }}</pre>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>


<script>
  function toggleSums() {
    document.querySelectorAll('.player-card').forEach(card => {
      card.classList.toggle('show-sum');
    });
  }
</script>

{% endblock %}